# Java 垃圾回收
***
## 垃圾回收机制
### 回收发送在哪里
- 确定性分配和回收
    - 程序计数器、虚拟机栈、本地方法栈线程私有，随着线程的创建而创建、销毁而销毁
    - 栈中的栈幁随着方法的进出操作，内存一致
- 不确定分配和回收
    - 堆中对象的回收
    - 方法区中废弃常量和无用类的回收

### 对象什么时候进行回收
&ensp;&ensp;&ensp;&ensp;当一个对象不再被引用（Java四种引用：强、软、弱、虚）时，可以进行回收。有下面两种方法进行判断，目前采用的第二种：

- 引用计数算法：这种算法是通过一个对象的引用计数器来判断该对象是否被引用了。每当对象被引用，引用计数器就会加 1；每当引用失效，计数器就会减 1。当对象的引用计数器的值为 0 时，就说明该对象不再被引用，可以被回收了。这里强调一点，虽然引用计数算法的实现简单，判断效率也很高，但它存在着对象之间相互循环引用的问题。

- 可达性分析算法：GC Roots 是该算法的基础，GC Roots 是所有对象的根对象，在 JVM 加载时，会创建一些普通对象引用正常对象。这些对象作为正常对象的起始点，在垃圾回收时，会从这些 GC Roots 开始向下搜索，当一个对象到 GC Roots 没有任何引用链相连时，就证明此对象是不可用的。目前 HotSpot 虚拟机采用的就是这种算法。

### 如何回收这些对象
&ensp;&ensp;&ensp;&ensp;单独起了一个系统级线程进行检查回收，不能强制执行，所有具有不可预期性

### GC算法
&ensp;&ensp;&ensp;&ensp;算法及回收器如下图：

![来着极客时间：https://time.geekbang.org/column/article/107396](./picture/GCAlgorithm.jpg)

### GC性能衡量指标
- 吞吐量
- 停顿时间
- 垃圾回收频率

### GC调优策略
- 1. 降低 Minor GC 频率
- 2. 降低 Full GC 的频率(减少创建大对象/增大堆内存空间/选择合适的 GC 回收器)